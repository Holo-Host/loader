{"id":"../web/hClient/src/index.js","dependencies":[{"name":"/home/willem/repos/loader/web/hClient/.babelrc","includedInParent":true,"mtime":1550719804857},{"name":"/home/willem/repos/loader/test/package.json","includedInParent":true,"mtime":1550794047826},{"name":"babel-polyfill","loc":{"line":1,"column":8},"parent":"/home/willem/repos/loader/web/hClient/src/index.js","resolved":"/home/willem/repos/loader/web/hClient/node_modules/babel-polyfill/lib/index.js"},{"name":"./keyManagement","loc":{"line":15,"column":44},"parent":"/home/willem/repos/loader/web/hClient/src/index.js","resolved":"/home/willem/repos/loader/web/hClient/src/keyManagement.js"}],"generated":{"js":"require('babel-polyfill');\n/**\n * hClient.js\n * An API compatible drop-in for hc-web-client. This is inserted by the loader on page load and overrideWebClient() called\n * \n * Exports a single function, overrideWebClient, that will instantly holo-ify a holochain app.\n * It adds the additional functionality of\n *     - Connecting to the correct holo-port\n *     - Signing all calls with the agents private key\n *     - Intercepting 401 responses to display a login screen\n */\n\n\nmodule.exports = hClient = function () {\n  const {\n    generateReadonlyKey\n  } = require(\"./keyManagement\");\n  /**\n   * Wraps and overwrites the current holochainClient attached to the window\n   * Keeps the same functionaltiy but adds preCall and postCall hooks and also forces\n   * connect to go to a given URL\n   *\n   * @param      {<type>}    url       The url to connect to\n   * @param      {Function}  preCall   The pre call funciton. Takes the callString and params and returns new callString and params\n   * @param      {Function   postCall  The post call function. Takes the response and returns the new response\n   * @param      {Function   postConnect  The post connect function. Takes a RPC-websockets object and returns it\n   */\n\n\n  const overrideWebClient = (url, preCall, postCall, postConnect) => {\n    const holochainClient = window.holochainClient;\n    window.holochainClient = {\n      connect: () => holochainClient.connect(url).then(({\n        call,\n        close,\n        ws\n      }) => {\n        ws = postConnect(ws);\n        return {\n          call: callString => params => {\n            const {\n              callString: newCallString,\n              params: newParams\n            } = preCall(callString, params);\n            return call(newCallString)(newParams).then(postCall);\n          },\n          close,\n          ws\n        };\n      })\n    };\n  };\n  /**\n   * Preprocesses the callString and params before making a call\n   *\n   * @param      {string}  callString  The call string e.g. dna/zome/function\n   * @param      {Object}  params      The parameters \n   * @return     {callString, params}  The updated callString and params passed to call\n   */\n\n\n  const preCall = (callString, params) => {\n    // TODO: sign the call and add the signature to the params object\n    return {\n      callString,\n      params\n    };\n  };\n  /**\n   * Postprocess the response of a call before returning it to the UI\n   *\n   * @param      {string}  response  The response of the call\n   * @return     {string}  Updated response\n   */\n\n\n  const postCall = response => {\n    // TODO: Check response for authentication error to see if login is required\n    // TODO: Sign the response and sent it back to the interceptor\n    // TODO: Unpack the response to expose to the UI code (make it look like a regular holochain call)\n    return response;\n  };\n  /**\n   * Add any new callbacks to the websocket object or make calls immediatly after connecting\n   *\n   * @param      {<type>}  ws      { rpc=websockets object }\n   */\n\n\n  const postConnect = ws => {\n    // TODO: subscribe to a rpc-websocket callback for sigining actions\n    // e.g.\n    // ws.subscribe(\"sign_entry\");\n    // ws.on(\"sign_entry\", () => {\n    //     // Sign the response and then send it back to the interceptor\n    // });\n    return ws;\n  };\n\n  return {\n    overrideWebClient,\n    generateReadonlyKey\n  };\n}();","map":{"mappings":[{"name":"require","generated":{"line":1,"column":0},"source":"../web/hClient/src/index.js","original":{"line":1,"column":0}},{"generated":{"line":1,"column":7},"source":"../web/hClient/src/index.js","original":{"line":1,"column":7}},{"generated":{"line":1,"column":8},"source":"../web/hClient/src/index.js","original":{"line":1,"column":8}},{"generated":{"line":1,"column":24},"source":"../web/hClient/src/index.js","original":{"line":1,"column":7}},{"generated":{"line":1,"column":25},"source":"../web/hClient/src/index.js","original":{"line":1,"column":0}},{"generated":{"line":2,"column":0},"source":"../web/hClient/src/index.js","original":{"line":2,"column":0}},{"name":"module","generated":{"line":14,"column":0},"source":"../web/hClient/src/index.js","original":{"line":13,"column":0}},{"generated":{"line":14,"column":6},"source":"../web/hClient/src/index.js","original":{"line":13,"column":6}},{"name":"exports","generated":{"line":14,"column":7},"source":"../web/hClient/src/index.js","original":{"line":13,"column":7}},{"generated":{"line":14,"column":14},"source":"../web/hClient/src/index.js","original":{"line":13,"column":0}},{"name":"hClient","generated":{"line":14,"column":17},"source":"../web/hClient/src/index.js","original":{"line":13,"column":17}},{"generated":{"line":14,"column":24},"source":"../web/hClient/src/index.js","original":{"line":13,"column":24}},{"generated":{"line":14,"column":27},"source":"../web/hClient/src/index.js","original":{"line":13,"column":28}},{"generated":{"line":14,"column":39},"source":"../web/hClient/src/index.js","original":{"line":13,"column":38}},{"generated":{"line":15,"column":0},"source":"../web/hClient/src/index.js","original":{"line":15,"column":4}},{"generated":{"line":15,"column":8},"source":"../web/hClient/src/index.js","original":{"line":15,"column":10}},{"name":"generateReadonlyKey","generated":{"line":16,"column":0},"source":"../web/hClient/src/index.js","original":{"line":15,"column":12}},{"name":"generateReadonlyKey","generated":{"line":16,"column":4},"source":"../web/hClient/src/index.js","original":{"line":15,"column":12}},{"generated":{"line":17,"column":0},"source":"../web/hClient/src/index.js","original":{"line":15,"column":10}},{"name":"require","generated":{"line":17,"column":6},"source":"../web/hClient/src/index.js","original":{"line":15,"column":36}},{"generated":{"line":17,"column":13},"source":"../web/hClient/src/index.js","original":{"line":15,"column":43}},{"generated":{"line":17,"column":14},"source":"../web/hClient/src/index.js","original":{"line":15,"column":44}},{"generated":{"line":17,"column":31},"source":"../web/hClient/src/index.js","original":{"line":15,"column":43}},{"generated":{"line":17,"column":32},"source":"../web/hClient/src/index.js","original":{"line":15,"column":4}},{"generated":{"line":18,"column":0},"source":"../web/hClient/src/index.js","original":{"line":17,"column":4}},{"generated":{"line":30,"column":0},"source":"../web/hClient/src/index.js","original":{"line":27,"column":4}},{"name":"overrideWebClient","generated":{"line":30,"column":8},"source":"../web/hClient/src/index.js","original":{"line":27,"column":10}},{"generated":{"line":30,"column":25},"source":"../web/hClient/src/index.js","original":{"line":27,"column":27}},{"generated":{"line":30,"column":28},"source":"../web/hClient/src/index.js","original":{"line":27,"column":30}},{"name":"url","generated":{"line":30,"column":29},"source":"../web/hClient/src/index.js","original":{"line":27,"column":31}},{"generated":{"line":30,"column":32},"source":"../web/hClient/src/index.js","original":{"line":27,"column":30}},{"name":"preCall","generated":{"line":30,"column":34},"source":"../web/hClient/src/index.js","original":{"line":27,"column":36}},{"generated":{"line":30,"column":41},"source":"../web/hClient/src/index.js","original":{"line":27,"column":30}},{"name":"postCall","generated":{"line":30,"column":43},"source":"../web/hClient/src/index.js","original":{"line":27,"column":45}},{"generated":{"line":30,"column":51},"source":"../web/hClient/src/index.js","original":{"line":27,"column":30}},{"name":"postConnect","generated":{"line":30,"column":53},"source":"../web/hClient/src/index.js","original":{"line":27,"column":55}},{"generated":{"line":30,"column":64},"source":"../web/hClient/src/index.js","original":{"line":27,"column":30}},{"generated":{"line":30,"column":69},"source":"../web/hClient/src/index.js","original":{"line":27,"column":71}},{"generated":{"line":31,"column":0},"source":"../web/hClient/src/index.js","original":{"line":28,"column":8}},{"name":"holochainClient","generated":{"line":31,"column":10},"source":"../web/hClient/src/index.js","original":{"line":28,"column":14}},{"generated":{"line":31,"column":25},"source":"../web/hClient/src/index.js","original":{"line":28,"column":29}},{"name":"window","generated":{"line":31,"column":28},"source":"../web/hClient/src/index.js","original":{"line":28,"column":32}},{"generated":{"line":31,"column":34},"source":"../web/hClient/src/index.js","original":{"line":28,"column":38}},{"name":"holochainClient","generated":{"line":31,"column":35},"source":"../web/hClient/src/index.js","original":{"line":28,"column":39}},{"generated":{"line":31,"column":50},"source":"../web/hClient/src/index.js","original":{"line":28,"column":8}},{"name":"window","generated":{"line":32,"column":0},"source":"../web/hClient/src/index.js","original":{"line":30,"column":8}},{"name":"window","generated":{"line":32,"column":4},"source":"../web/hClient/src/index.js","original":{"line":30,"column":8}},{"generated":{"line":32,"column":10},"source":"../web/hClient/src/index.js","original":{"line":30,"column":14}},{"name":"holochainClient","generated":{"line":32,"column":11},"source":"../web/hClient/src/index.js","original":{"line":30,"column":15}},{"generated":{"line":32,"column":26},"source":"../web/hClient/src/index.js","original":{"line":30,"column":8}},{"generated":{"line":32,"column":29},"source":"../web/hClient/src/index.js","original":{"line":30,"column":33}},{"name":"connect","generated":{"line":33,"column":0},"source":"../web/hClient/src/index.js","original":{"line":31,"column":12}},{"name":"connect","generated":{"line":33,"column":6},"source":"../web/hClient/src/index.js","original":{"line":31,"column":12}},{"generated":{"line":33,"column":13},"source":"../web/hClient/src/index.js","original":{"line":31,"column":19}},{"generated":{"line":33,"column":15},"source":"../web/hClient/src/index.js","original":{"line":31,"column":21}},{"name":"holochainClient","generated":{"line":33,"column":21},"source":"../web/hClient/src/index.js","original":{"line":31,"column":27}},{"generated":{"line":33,"column":36},"source":"../web/hClient/src/index.js","original":{"line":31,"column":42}},{"name":"connect","generated":{"line":33,"column":37},"source":"../web/hClient/src/index.js","original":{"line":31,"column":43}},{"generated":{"line":33,"column":44},"source":"../web/hClient/src/index.js","original":{"line":31,"column":27}},{"name":"url","generated":{"line":33,"column":45},"source":"../web/hClient/src/index.js","original":{"line":31,"column":51}},{"generated":{"line":33,"column":48},"source":"../web/hClient/src/index.js","original":{"line":31,"column":27}},{"name":"then","generated":{"line":33,"column":50},"source":"../web/hClient/src/index.js","original":{"line":31,"column":56}},{"generated":{"line":33,"column":54},"source":"../web/hClient/src/index.js","original":{"line":31,"column":27}},{"generated":{"line":33,"column":55},"source":"../web/hClient/src/index.js","original":{"line":31,"column":61}},{"generated":{"line":33,"column":56},"source":"../web/hClient/src/index.js","original":{"line":31,"column":62}},{"name":"call","generated":{"line":34,"column":0},"source":"../web/hClient/src/index.js","original":{"line":31,"column":63}},{"name":"call","generated":{"line":34,"column":8},"source":"../web/hClient/src/index.js","original":{"line":31,"column":63}},{"generated":{"line":34,"column":12},"source":"../web/hClient/src/index.js","original":{"line":31,"column":62}},{"name":"close","generated":{"line":35,"column":0},"source":"../web/hClient/src/index.js","original":{"line":31,"column":69}},{"name":"close","generated":{"line":35,"column":8},"source":"../web/hClient/src/index.js","original":{"line":31,"column":69}},{"generated":{"line":35,"column":13},"source":"../web/hClient/src/index.js","original":{"line":31,"column":62}},{"name":"ws","generated":{"line":36,"column":0},"source":"../web/hClient/src/index.js","original":{"line":31,"column":76}},{"name":"ws","generated":{"line":36,"column":8},"source":"../web/hClient/src/index.js","original":{"line":31,"column":76}},{"generated":{"line":37,"column":0},"source":"../web/hClient/src/index.js","original":{"line":31,"column":62}},{"generated":{"line":37,"column":7},"source":"../web/hClient/src/index.js","original":{"line":31,"column":61}},{"generated":{"line":37,"column":12},"source":"../web/hClient/src/index.js","original":{"line":31,"column":84}},{"name":"ws","generated":{"line":38,"column":0},"source":"../web/hClient/src/index.js","original":{"line":32,"column":16}},{"name":"ws","generated":{"line":38,"column":8},"source":"../web/hClient/src/index.js","original":{"line":32,"column":16}},{"generated":{"line":38,"column":10},"source":"../web/hClient/src/index.js","original":{"line":32,"column":18}},{"name":"postConnect","generated":{"line":38,"column":13},"source":"../web/hClient/src/index.js","original":{"line":32,"column":21}},{"generated":{"line":38,"column":24},"source":"../web/hClient/src/index.js","original":{"line":32,"column":32}},{"name":"ws","generated":{"line":38,"column":25},"source":"../web/hClient/src/index.js","original":{"line":32,"column":33}},{"generated":{"line":38,"column":27},"source":"../web/hClient/src/index.js","original":{"line":32,"column":32}},{"generated":{"line":38,"column":28},"source":"../web/hClient/src/index.js","original":{"line":32,"column":16}},{"generated":{"line":39,"column":0},"source":"../web/hClient/src/index.js","original":{"line":33,"column":16}},{"generated":{"line":39,"column":15},"source":"../web/hClient/src/index.js","original":{"line":33,"column":23}},{"name":"call","generated":{"line":40,"column":0},"source":"../web/hClient/src/index.js","original":{"line":34,"column":20}},{"name":"call","generated":{"line":40,"column":10},"source":"../web/hClient/src/index.js","original":{"line":34,"column":20}},{"generated":{"line":40,"column":14},"source":"../web/hClient/src/index.js","original":{"line":34,"column":24}},{"name":"callString","generated":{"line":40,"column":16},"source":"../web/hClient/src/index.js","original":{"line":34,"column":27}},{"generated":{"line":40,"column":26},"source":"../web/hClient/src/index.js","original":{"line":34,"column":26}},{"name":"params","generated":{"line":40,"column":30},"source":"../web/hClient/src/index.js","original":{"line":34,"column":43}},{"generated":{"line":40,"column":36},"source":"../web/hClient/src/index.js","original":{"line":34,"column":42}},{"generated":{"line":40,"column":40},"source":"../web/hClient/src/index.js","original":{"line":34,"column":54}},{"generated":{"line":41,"column":0},"source":"../web/hClient/src/index.js","original":{"line":35,"column":24}},{"generated":{"line":41,"column":18},"source":"../web/hClient/src/index.js","original":{"line":35,"column":30}},{"name":"callString","generated":{"line":42,"column":0},"source":"../web/hClient/src/index.js","original":{"line":35,"column":31}},{"name":"callString","generated":{"line":42,"column":14},"source":"../web/hClient/src/index.js","original":{"line":35,"column":31}},{"generated":{"line":42,"column":24},"source":"../web/hClient/src/index.js","original":{"line":35,"column":41}},{"name":"newCallString","generated":{"line":42,"column":26},"source":"../web/hClient/src/index.js","original":{"line":35,"column":43}},{"generated":{"line":42,"column":39},"source":"../web/hClient/src/index.js","original":{"line":35,"column":30}},{"name":"params","generated":{"line":43,"column":0},"source":"../web/hClient/src/index.js","original":{"line":35,"column":58}},{"name":"params","generated":{"line":43,"column":14},"source":"../web/hClient/src/index.js","original":{"line":35,"column":58}},{"generated":{"line":43,"column":20},"source":"../web/hClient/src/index.js","original":{"line":35,"column":64}},{"name":"newParams","generated":{"line":43,"column":22},"source":"../web/hClient/src/index.js","original":{"line":35,"column":66}},{"generated":{"line":44,"column":0},"source":"../web/hClient/src/index.js","original":{"line":35,"column":30}},{"name":"preCall","generated":{"line":44,"column":16},"source":"../web/hClient/src/index.js","original":{"line":35,"column":79}},{"generated":{"line":44,"column":23},"source":"../web/hClient/src/index.js","original":{"line":35,"column":86}},{"name":"callString","generated":{"line":44,"column":24},"source":"../web/hClient/src/index.js","original":{"line":35,"column":87}},{"generated":{"line":44,"column":34},"source":"../web/hClient/src/index.js","original":{"line":35,"column":86}},{"name":"params","generated":{"line":44,"column":36},"source":"../web/hClient/src/index.js","original":{"line":35,"column":99}},{"generated":{"line":44,"column":42},"source":"../web/hClient/src/index.js","original":{"line":35,"column":86}},{"generated":{"line":44,"column":43},"source":"../web/hClient/src/index.js","original":{"line":35,"column":24}},{"generated":{"line":45,"column":0},"source":"../web/hClient/src/index.js","original":{"line":36,"column":24}},{"name":"call","generated":{"line":45,"column":19},"source":"../web/hClient/src/index.js","original":{"line":36,"column":31}},{"generated":{"line":45,"column":23},"source":"../web/hClient/src/index.js","original":{"line":36,"column":35}},{"name":"newCallString","generated":{"line":45,"column":24},"source":"../web/hClient/src/index.js","original":{"line":36,"column":36}},{"generated":{"line":45,"column":37},"source":"../web/hClient/src/index.js","original":{"line":36,"column":35}},{"generated":{"line":45,"column":38},"source":"../web/hClient/src/index.js","original":{"line":36,"column":31}},{"name":"newParams","generated":{"line":45,"column":39},"source":"../web/hClient/src/index.js","original":{"line":36,"column":51}},{"generated":{"line":45,"column":48},"source":"../web/hClient/src/index.js","original":{"line":36,"column":31}},{"name":"then","generated":{"line":45,"column":50},"source":"../web/hClient/src/index.js","original":{"line":36,"column":62}},{"generated":{"line":45,"column":54},"source":"../web/hClient/src/index.js","original":{"line":36,"column":31}},{"name":"postCall","generated":{"line":45,"column":55},"source":"../web/hClient/src/index.js","original":{"line":36,"column":67}},{"generated":{"line":45,"column":63},"source":"../web/hClient/src/index.js","original":{"line":36,"column":31}},{"generated":{"line":45,"column":64},"source":"../web/hClient/src/index.js","original":{"line":36,"column":24}},{"generated":{"line":46,"column":0},"source":"../web/hClient/src/index.js","original":{"line":37,"column":21}},{"generated":{"line":46,"column":11},"source":"../web/hClient/src/index.js","original":{"line":33,"column":23}},{"name":"close","generated":{"line":47,"column":0},"source":"../web/hClient/src/index.js","original":{"line":38,"column":20}},{"name":"close","generated":{"line":47,"column":10},"source":"../web/hClient/src/index.js","original":{"line":38,"column":20}},{"generated":{"line":47,"column":15},"source":"../web/hClient/src/index.js","original":{"line":33,"column":23}},{"name":"ws","generated":{"line":48,"column":0},"source":"../web/hClient/src/index.js","original":{"line":39,"column":20}},{"name":"ws","generated":{"line":48,"column":10},"source":"../web/hClient/src/index.js","original":{"line":39,"column":20}},{"generated":{"line":49,"column":0},"source":"../web/hClient/src/index.js","original":{"line":33,"column":23}},{"generated":{"line":49,"column":9},"source":"../web/hClient/src/index.js","original":{"line":33,"column":16}},{"generated":{"line":50,"column":0},"source":"../web/hClient/src/index.js","original":{"line":41,"column":13}},{"generated":{"line":50,"column":7},"source":"../web/hClient/src/index.js","original":{"line":31,"column":27}},{"generated":{"line":51,"column":0},"source":"../web/hClient/src/index.js","original":{"line":30,"column":33}},{"generated":{"line":51,"column":5},"source":"../web/hClient/src/index.js","original":{"line":30,"column":8}},{"generated":{"line":52,"column":0},"source":"../web/hClient/src/index.js","original":{"line":43,"column":5}},{"generated":{"line":52,"column":3},"source":"../web/hClient/src/index.js","original":{"line":27,"column":4}},{"generated":{"line":53,"column":0},"source":"../web/hClient/src/index.js","original":{"line":45,"column":4}},{"generated":{"line":62,"column":0},"source":"../web/hClient/src/index.js","original":{"line":52,"column":4}},{"name":"preCall","generated":{"line":62,"column":8},"source":"../web/hClient/src/index.js","original":{"line":52,"column":10}},{"generated":{"line":62,"column":15},"source":"../web/hClient/src/index.js","original":{"line":52,"column":17}},{"generated":{"line":62,"column":18},"source":"../web/hClient/src/index.js","original":{"line":52,"column":20}},{"name":"callString","generated":{"line":62,"column":19},"source":"../web/hClient/src/index.js","original":{"line":52,"column":21}},{"generated":{"line":62,"column":29},"source":"../web/hClient/src/index.js","original":{"line":52,"column":20}},{"name":"params","generated":{"line":62,"column":31},"source":"../web/hClient/src/index.js","original":{"line":52,"column":33}},{"generated":{"line":62,"column":37},"source":"../web/hClient/src/index.js","original":{"line":52,"column":20}},{"generated":{"line":62,"column":42},"source":"../web/hClient/src/index.js","original":{"line":52,"column":44}},{"generated":{"line":63,"column":0},"source":"../web/hClient/src/index.js","original":{"line":53,"column":8}},{"generated":{"line":64,"column":0},"source":"../web/hClient/src/index.js","original":{"line":54,"column":8}},{"generated":{"line":64,"column":11},"source":"../web/hClient/src/index.js","original":{"line":54,"column":15}},{"name":"callString","generated":{"line":65,"column":0},"source":"../web/hClient/src/index.js","original":{"line":54,"column":16}},{"name":"callString","generated":{"line":65,"column":6},"source":"../web/hClient/src/index.js","original":{"line":54,"column":16}},{"generated":{"line":65,"column":16},"source":"../web/hClient/src/index.js","original":{"line":54,"column":15}},{"name":"params","generated":{"line":66,"column":0},"source":"../web/hClient/src/index.js","original":{"line":54,"column":28}},{"name":"params","generated":{"line":66,"column":6},"source":"../web/hClient/src/index.js","original":{"line":54,"column":28}},{"generated":{"line":67,"column":0},"source":"../web/hClient/src/index.js","original":{"line":54,"column":15}},{"generated":{"line":67,"column":5},"source":"../web/hClient/src/index.js","original":{"line":54,"column":8}},{"generated":{"line":68,"column":0},"source":"../web/hClient/src/index.js","original":{"line":55,"column":5}},{"generated":{"line":68,"column":3},"source":"../web/hClient/src/index.js","original":{"line":52,"column":4}},{"generated":{"line":69,"column":0},"source":"../web/hClient/src/index.js","original":{"line":57,"column":4}},{"generated":{"line":77,"column":0},"source":"../web/hClient/src/index.js","original":{"line":63,"column":4}},{"name":"postCall","generated":{"line":77,"column":8},"source":"../web/hClient/src/index.js","original":{"line":63,"column":10}},{"generated":{"line":77,"column":16},"source":"../web/hClient/src/index.js","original":{"line":63,"column":18}},{"name":"response","generated":{"line":77,"column":19},"source":"../web/hClient/src/index.js","original":{"line":63,"column":22}},{"generated":{"line":77,"column":27},"source":"../web/hClient/src/index.js","original":{"line":63,"column":21}},{"generated":{"line":77,"column":31},"source":"../web/hClient/src/index.js","original":{"line":63,"column":35}},{"generated":{"line":78,"column":0},"source":"../web/hClient/src/index.js","original":{"line":64,"column":8}},{"generated":{"line":79,"column":0},"source":"../web/hClient/src/index.js","original":{"line":65,"column":8}},{"generated":{"line":80,"column":0},"source":"../web/hClient/src/index.js","original":{"line":66,"column":8}},{"generated":{"line":81,"column":0},"source":"../web/hClient/src/index.js","original":{"line":67,"column":8}},{"name":"response","generated":{"line":81,"column":11},"source":"../web/hClient/src/index.js","original":{"line":67,"column":15}},{"generated":{"line":81,"column":19},"source":"../web/hClient/src/index.js","original":{"line":67,"column":8}},{"generated":{"line":82,"column":0},"source":"../web/hClient/src/index.js","original":{"line":68,"column":5}},{"generated":{"line":82,"column":3},"source":"../web/hClient/src/index.js","original":{"line":63,"column":4}},{"generated":{"line":83,"column":0},"source":"../web/hClient/src/index.js","original":{"line":70,"column":4}},{"generated":{"line":90,"column":0},"source":"../web/hClient/src/index.js","original":{"line":75,"column":4}},{"name":"postConnect","generated":{"line":90,"column":8},"source":"../web/hClient/src/index.js","original":{"line":75,"column":10}},{"generated":{"line":90,"column":19},"source":"../web/hClient/src/index.js","original":{"line":75,"column":21}},{"name":"ws","generated":{"line":90,"column":22},"source":"../web/hClient/src/index.js","original":{"line":75,"column":25}},{"generated":{"line":90,"column":24},"source":"../web/hClient/src/index.js","original":{"line":75,"column":24}},{"generated":{"line":90,"column":28},"source":"../web/hClient/src/index.js","original":{"line":75,"column":32}},{"generated":{"line":91,"column":0},"source":"../web/hClient/src/index.js","original":{"line":76,"column":8}},{"generated":{"line":92,"column":0},"source":"../web/hClient/src/index.js","original":{"line":77,"column":8}},{"generated":{"line":93,"column":0},"source":"../web/hClient/src/index.js","original":{"line":78,"column":8}},{"generated":{"line":94,"column":0},"source":"../web/hClient/src/index.js","original":{"line":79,"column":8}},{"generated":{"line":95,"column":0},"source":"../web/hClient/src/index.js","original":{"line":80,"column":8}},{"generated":{"line":96,"column":0},"source":"../web/hClient/src/index.js","original":{"line":81,"column":8}},{"generated":{"line":97,"column":0},"source":"../web/hClient/src/index.js","original":{"line":82,"column":8}},{"name":"ws","generated":{"line":97,"column":11},"source":"../web/hClient/src/index.js","original":{"line":82,"column":15}},{"generated":{"line":97,"column":13},"source":"../web/hClient/src/index.js","original":{"line":82,"column":8}},{"generated":{"line":98,"column":0},"source":"../web/hClient/src/index.js","original":{"line":83,"column":5}},{"generated":{"line":98,"column":3},"source":"../web/hClient/src/index.js","original":{"line":75,"column":4}},{"generated":{"line":100,"column":0},"source":"../web/hClient/src/index.js","original":{"line":85,"column":4}},{"generated":{"line":100,"column":9},"source":"../web/hClient/src/index.js","original":{"line":85,"column":11}},{"name":"overrideWebClient","generated":{"line":101,"column":0},"source":"../web/hClient/src/index.js","original":{"line":86,"column":8}},{"name":"overrideWebClient","generated":{"line":101,"column":4},"source":"../web/hClient/src/index.js","original":{"line":86,"column":8}},{"generated":{"line":101,"column":21},"source":"../web/hClient/src/index.js","original":{"line":85,"column":11}},{"name":"generateReadonlyKey","generated":{"line":102,"column":0},"source":"../web/hClient/src/index.js","original":{"line":87,"column":8}},{"name":"generateReadonlyKey","generated":{"line":102,"column":4},"source":"../web/hClient/src/index.js","original":{"line":87,"column":8}},{"generated":{"line":103,"column":0},"source":"../web/hClient/src/index.js","original":{"line":85,"column":11}},{"generated":{"line":103,"column":3},"source":"../web/hClient/src/index.js","original":{"line":85,"column":4}},{"generated":{"line":104,"column":0},"source":"../web/hClient/src/index.js","original":{"line":90,"column":1}},{"generated":{"line":104,"column":1},"source":"../web/hClient/src/index.js","original":{"line":13,"column":27}},{"generated":{"line":104,"column":3},"source":"../web/hClient/src/index.js","original":{"line":13,"column":0}}],"sources":{"../web/hClient/src/index.js":"require('babel-polyfill');\n/**\n * hClient.js\n * An API compatible drop-in for hc-web-client. This is inserted by the loader on page load and overrideWebClient() called\n * \n * Exports a single function, overrideWebClient, that will instantly holo-ify a holochain app.\n * It adds the additional functionality of\n *     - Connecting to the correct holo-port\n *     - Signing all calls with the agents private key\n *     - Intercepting 401 responses to display a login screen\n */\n\nmodule.exports = hClient = (function(){\n\n    const { generateReadonlyKey } = require(\"./keyManagement\");\n\n    /**\n     * Wraps and overwrites the current holochainClient attached to the window\n     * Keeps the same functionaltiy but adds preCall and postCall hooks and also forces\n     * connect to go to a given URL\n     *\n     * @param      {<type>}    url       The url to connect to\n     * @param      {Function}  preCall   The pre call funciton. Takes the callString and params and returns new callString and params\n     * @param      {Function   postCall  The post call function. Takes the response and returns the new response\n     * @param      {Function   postConnect  The post connect function. Takes a RPC-websockets object and returns it\n     */\n    const overrideWebClient = (url, preCall, postCall, postConnect) => {\n        const holochainClient = window.holochainClient;\n\n        window.holochainClient = {\n            connect: () => holochainClient.connect(url).then(({call, close, ws}) => {\n                ws = postConnect(ws);\n                return {\n                    call: (callString) => (params) => {\n                        const {callString: newCallString, params: newParams} = preCall(callString, params);\n                        return call(newCallString)(newParams).then(postCall);\n                    },\n                    close,\n                    ws,\n                }\n            })\n        };\n    }\n\n    /**\n     * Preprocesses the callString and params before making a call\n     *\n     * @param      {string}  callString  The call string e.g. dna/zome/function\n     * @param      {Object}  params      The parameters \n     * @return     {callString, params}  The updated callString and params passed to call\n     */\n    const preCall = (callString, params) => {\n        // TODO: sign the call and add the signature to the params object\n        return {callString, params};\n    }\n\n    /**\n     * Postprocess the response of a call before returning it to the UI\n     *\n     * @param      {string}  response  The response of the call\n     * @return     {string}  Updated response\n     */\n    const postCall = (response) => {\n        // TODO: Check response for authentication error to see if login is required\n        // TODO: Sign the response and sent it back to the interceptor\n        // TODO: Unpack the response to expose to the UI code (make it look like a regular holochain call)\n        return response;\n    }\n\n    /**\n     * Add any new callbacks to the websocket object or make calls immediatly after connecting\n     *\n     * @param      {<type>}  ws      { rpc=websockets object }\n     */\n    const postConnect = (ws) => {\n        // TODO: subscribe to a rpc-websocket callback for sigining actions\n        // e.g.\n        // ws.subscribe(\"sign_entry\");\n        // ws.on(\"sign_entry\", () => {\n        //     // Sign the response and then send it back to the interceptor\n        // });\n        return ws;\n    }\n\n    return {\n        overrideWebClient,\n        generateReadonlyKey,\n    };\n\n})();\n"},"lineCount":null}},"hash":"e193baa2587d6d58d219b05bcec579b5","cacheData":{"env":{}}}